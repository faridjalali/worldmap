<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>South America Map Quiz (Offline Fixed)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    
    <style>
        body { margin: 0; background-color: #050505; color: white; font-family: sans-serif; overflow: hidden; }
        
        /* The Map Stage */
        #map-stage { 
            width: 100vw; 
            height: 100vh; 
            /* Red border helps you see if the div exists. Remove later if you want. */
            border: 1px solid #333; 
        }

        /* Country Styling */
        .country { 
            fill: #1a1a1a; 
            stroke: #444; 
            stroke-width: 1px; 
            cursor: pointer; 
            transition: all 0.2s ease;
        }
        .country:hover { fill: #333; stroke: #fff; }
        
        /* Quiz Feedback States */
        .correct { fill: #00ff9d !important; transition: fill 0.1s; }
        .wrong { fill: #ff0055 !important; transition: fill 0.1s; }

        /* UI Styling */
        #ui-layer { position: absolute; top: 20px; width: 100%; pointer-events: none; display: flex; flex-direction: column; align-items: center; }
        .hud-panel { pointer-events: auto; background: rgba(30,30,30,0.9); padding: 15px 30px; border-radius: 30px; border: 1px solid #555; text-align: center; }
        .label { font-size: 0.8rem; color: #888; letter-spacing: 2px; text-transform: uppercase; }
        .main-text { font-size: 2rem; font-weight: 900; color: white; margin: 5px 0; }
        .sub-text { color: #00f3ff; font-weight: bold; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="hud-panel">
            <div class="label">Find Country</div>
            <div id="target-display" class="main-text">Loading...</div>
            <div id="score-display" class="sub-text">Score: 0</div>
        </div>
    </div>

    <div id="map-stage"></div>

    <script>
        // --- 1. EMBEDDED MAP DATA (Fixed Structure) ---
        // These are simplified polygon shapes for South America.
        // NOTE: Coordinates are [[[x,y], [x,y]]] (Triple nested)
        const southAmericaGeoJSON = {
            "type": "FeatureCollection",
            "features": [
                { "id": "ARG", "properties": { "name": "Argentina" }, "geometry": { "type": "Polygon", "coordinates": [[ [-68,-55], [-73,-50], [-70,-30], [-65,-22], [-55,-26], [-57,-35], [-68,-55] ]] } },
                { "id": "BOL", "properties": { "name": "Bolivia" }, "geometry": { "type": "Polygon", "coordinates": [[ [-69,-17], [-65,-10], [-60,-13], [-58,-20], [-62,-22], [-69,-23], [-69,-17] ]] } },
                { "id": "BRA", "properties": { "name": "Brazil" }, "geometry": { "type": "Polygon", "coordinates": [[ [-53,-33], [-58,-30], [-58,-20], [-70,-10], [-70,-5], [-65,0], [-50,2], [-35,-5], [-39,-18], [-53,-33] ]] } },
                { "id": "CHL", "properties": { "name": "Chile" }, "geometry": { "type": "Polygon", "coordinates": [[ [-75,-55], [-70,-55], [-68,-22], [-70,-18], [-74,-18], [-75,-55] ]] } },
                { "id": "COL", "properties": { "name": "Colombia" }, "geometry": { "type": "Polygon", "coordinates": [[ [-79,2], [-77,8], [-72,12], [-67,6], [-67,1], [-70,-4], [-79,2] ]] } },
                { "id": "ECU", "properties": { "name": "Ecuador" }, "geometry": { "type": "Polygon", "coordinates": [[ [-81,-3], [-78,1], [-75,-1], [-80,-5], [-81,-3] ]] } },
                { "id": "GUY", "properties": { "name": "Guyana" }, "geometry": { "type": "Polygon", "coordinates": [[ [-61,8], [-57,6], [-58,1], [-61,4], [-61,8] ]] } },
                { "id": "PRY", "properties": { "name": "Paraguay" }, "geometry": { "type": "Polygon", "coordinates": [[ [-62,-22], [-55,-22], [-55,-27], [-58,-27], [-62,-22] ]] } },
                { "id": "PER", "properties": { "name": "Peru" }, "geometry": { "type": "Polygon", "coordinates": [[ [-81,-5], [-70,-3], [-69,-15], [-70,-18], [-75,-15], [-81,-5] ]] } },
                { "id": "SUR", "properties": { "name": "Suriname" }, "geometry": { "type": "Polygon", "coordinates": [[ [-57,6], [-54,6], [-54,2], [-57,2], [-57,6] ]] } },
                { "id": "URY", "properties": { "name": "Uruguay" }, "geometry": { "type": "Polygon", "coordinates": [[ [-58,-34], [-53,-32], [-53,-35], [-58,-34] ]] } },
                { "id": "VEN", "properties": { "name": "Venezuela" }, "geometry": { "type": "Polygon", "coordinates": [[ [-73,12], [-60,10], [-60,4], [-67,1], [-73,12] ]] } }
            ]
        };

        // --- 2. GAME LOGIC ---
        let score = 0;
        let targetISO = "";
        
        // Setup SVG
        const container = document.getElementById("map-stage");
        const width = container.clientWidth;
        const height = container.clientHeight;
        
        const svg = d3.select("#map-stage").append("svg")
            .attr("width", width)
            .attr("height", height)
            .attr("viewBox", `0 0 ${width} ${height}`);

        // Define Projection (Auto-fits the data to the screen)
        const projection = d3.geoMercator()
            .fitSize([width, height], southAmericaGeoJSON);
            
        const pathGenerator = d3.geoPath().projection(projection);

        // Draw Map
        const g = svg.append("g");
        
        g.selectAll("path")
            .data(southAmericaGeoJSON.features)
            .enter()
            .append("path")
            .attr("d", pathGenerator)
            .attr("class", "country")
            .attr("id", d => d.id)
            .on("click", handleInput);

        // Start Game
        pickNewTarget();

        function pickNewTarget() {
            const features = southAmericaGeoJSON.features;
            const random = features[Math.floor(Math.random() * features.length)];
            targetISO = random.id;
            
            // UI Update
            document.getElementById("target-display").innerText = random.properties.name;
            
            // Clear previous colors
            d3.selectAll(".country").classed("correct", false).classed("wrong", false);
        }

        function handleInput(e, d) {
            const clickedISO = d.id;
            const el = d3.select(this);

            if (clickedISO === targetISO) {
                // Correct
                score += 10;
                el.classed("correct", true);
                setTimeout(pickNewTarget, 600);
            } else {
                // Wrong
                score -= 5;
                el.classed("wrong", true);
                setTimeout(() => el.classed("wrong", false), 400);
            }
            document.getElementById("score-display").innerText = "Score: " + score;
        }

        // Handle Window Resize
        window.addEventListener("resize", () => {
            const w = container.clientWidth;
            const h = container.clientHeight;
            svg.attr("width", w).attr("height", h);
            projection.fitSize([w, h], southAmericaGeoJSON);
            g.selectAll("path").attr("d", pathGenerator);
        });

    </script>
</body>
</html>
